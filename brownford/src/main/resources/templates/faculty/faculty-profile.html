<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Profile - Brown Ford University</title>
    <link rel="icon" type="image/png" th:href="@{/images/logo-circle.png}">
    <link rel="stylesheet" th:href="@{/css/base.css}">
    <link rel="stylesheet" th:href="@{/css/base.css}">
    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link
        href="https://fonts.googleapis.com/css2?family=Alice&family=Cinzel&family=Cinzel+Decorative&family=Cormorant+Garamond&display=swap"
        rel="stylesheet" />
    <script th:src="@{/js/headerFooter.js}"></script>
    <script th:src="@{/js/notifications.js}"></script>
</head>

<body>
    <faculty-header></faculty-header>

    <div class="background-container">
        <div class="background-image"></div>

        <!-- Main Content -->
        <main class="profile-content">
            <div class="profile-header">
                <div class="profile-avatar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none"
                        stroke="#6B3A1D" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </div>
                <div class="profile-title">
                    <h2 class="profile-name" id="profileName">Full Name</h2>
                    <p class="profile-subtitle">Faculty Profile</p>
                </div>
            </div>

            <div class="profile-card">
                <div class="profile-section">
                    <h3 class="section-title">Faculty Information</h3>
                    <div class="profile-info-grid">
                        <div class="info-item">
                            <span class="info-label">Faculty ID:</span>
                            <span class="info-value" id="facultyId">Faculty ID</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Full Name:</span>
                            <span class="info-value" id="fullName">Full Name</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Email:</span>
                            <span class="info-value" id="email">Email</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Address:</span>
                            <span class="info-value" id="address">Address</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Birthday:</span>
                            <span class="info-value" id="dateOfBirth">Birthday</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Gender:</span>
                            <span class="info-value" id="gender">Gender</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Cellphone Number:</span>
                            <span class="info-value" id="mobileNumber">Cellphone Number</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="profile-actions">
                <a href="#" class="profile-button" id="updateContactBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                    Update Contact Information
                </a>
                <a href="#" class="profile-button" id="changePasswordBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                    Change Password
                </a>
                <a href="#" class="profile-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Download Faculty ID
                </a>
            </div>
        </main>
    </div>

    <!-- Update Contact Modal -->
    <div id="contactModal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Update Contact Information</h3>
                <span class="close-modal" id="closeContactModal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="contactForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editGender">Gender:</label>
                            <select id="editGender" name="gender" class="form-control">
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editBirthday">Birthday:</label>
                            <input type="date" id="editBirthday" name="birthday" class="form-control">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editMobileNumber">Cellphone Number:</label>
                            <input type="text" id="editMobileNumber" name="mobileNumber" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="editAddress">Address:</label>
                            <input type="text" id="editAddress" name="address" class="form-control">
                        </div>
                    </div>
                    <div style="text-align:right; margin-top:20px;">
                        <button type="submit" class="profile-button">Save</button>
                    </div>
                </form>
                <div id="contactFormMsg" style="margin-top:10px;"></div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="passwordModal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Change Password</h3>
                <span class="close-modal" id="closePasswordModal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="passwordForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="currentPassword">Current Password:</label>
                            <input type="password" id="currentPassword" name="currentPassword" class="form-control"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="newPassword">New Password:</label>
                            <input type="password" id="newPassword" name="newPassword" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="confirmPassword">Confirm New Password:</label>
                            <input type="password" id="confirmPassword" name="confirmPassword" class="form-control"
                                required>
                        </div>
                    </div>
                    <div style="text-align:right; margin-top:20px;">
                        <button type="submit" class="profile-button">Change Password</button>
                    </div>
                </form>
                <div id="passwordFormMsg" style="margin-top:10px;"></div>
            </div>
        </div>
    </div>

    <footer-footer></footer-footer>

    <script th:src="@{/js/modal-global.js}"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            fetch('/api/faculty/profile/info')
                .then(response => response.json())
                .then(data => {
                    function safe(val) { return val && val !== '' ? val : 'N/A'; }
                    const fullName = ((data.firstName ? data.firstName : '') + ' ' + (data.middleName ? data.middleName + ' ' : '') + (data.lastName ? data.lastName : ''));
                    document.getElementById('profileName').textContent = safe(fullName);
                    document.getElementById('facultyId').textContent = safe(data.facultyId);
                    document.getElementById('fullName').textContent = safe(fullName).toUpperCase();
                    document.getElementById('email').textContent = safe(data.email);
                    document.getElementById('gender').textContent = safe(data.gender);
                    document.getElementById('dateOfBirth').textContent = safe(data.dateOfBirth);
                    document.getElementById('mobileNumber').textContent = safe(data.mobileNumber);
                    document.getElementById('address').textContent = safe(data.address);
                    // Pre-fill modal fields if you add modals for editing
                    document.getElementById('editGender').value = data.gender || '';
                    document.getElementById('editBirthday').value = data.dateOfBirth || '';
                    document.getElementById('editMobileNumber').value = data.mobileNumber || '';
                    document.getElementById('editAddress').value = data.address || '';
                })
                .catch(() => {
                    [
                        'profileName', 'facultyId', 'fullName', 'email', 'address', 'dateOfBirth', 'gender', 'mobileNumber'
                    ].forEach(id => {
                        const el = document.getElementById(id);
                        if (el) el.textContent = 'N/A';
                    });
                });

            // Modal logic
            const contactModal = document.getElementById('contactModal');
            const updateContactBtn = document.getElementById('updateContactBtn');
            const closeContactModal = document.getElementById('closeContactModal');
            updateContactBtn.onclick = () => { contactModal.style.display = 'block'; };
            closeContactModal.onclick = () => { contactModal.style.display = 'none'; };
            window.onclick = function (event) {
                if (event.target === contactModal) contactModal.style.display = 'none';
                if (event.target === passwordModal) passwordModal.style.display = 'none';
            };
            // Pre-fill modal fields on open
            updateContactBtn.addEventListener('click', function () {
                document.getElementById('editGender').value = document.getElementById('gender').textContent !== 'N/A' ? document.getElementById('gender').textContent : '';
                document.getElementById('editBirthday').value = document.getElementById('dateOfBirth').textContent !== 'N/A' ? document.getElementById('dateOfBirth').textContent : '';
                document.getElementById('editMobileNumber').value = document.getElementById('mobileNumber').textContent !== 'N/A' ? document.getElementById('mobileNumber').textContent : '';
                document.getElementById('editAddress').value = document.getElementById('address').textContent !== 'N/A' ? document.getElementById('address').textContent : '';
            });
            // Contact form submit
            document.getElementById('contactForm').onsubmit = function (e) {
                e.preventDefault();
                const payload = {
                    gender: document.getElementById('editGender').value,
                    dateOfBirth: document.getElementById('editBirthday').value,
                    mobileNumber: document.getElementById('editMobileNumber').value,
                    address: document.getElementById('editAddress').value,
                };
                fetch('/api/faculty/profile/info', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                })
                    .then(res => res.json())
                    .then(resp => {
                        document.getElementById('contactFormMsg').textContent = 'Profile information updated!';
                        // Optionally update profile display
                        document.getElementById('gender').textContent = payload.gender;
                        document.getElementById('dateOfBirth').textContent = payload.dateOfBirth;
                        document.getElementById('mobileNumber').textContent = payload.mobileNumber;
                        document.getElementById('address').textContent = payload.address;
                    })
                    .catch(() => {
                        document.getElementById('contactFormMsg').textContent = 'Failed to update. Please try again.';
                    });
            };

            // Password modal logic
            const passwordModal = document.getElementById('passwordModal');
            const changePasswordBtn = document.querySelectorAll('.profile-actions .profile-button')[1];
            const closePasswordModal = document.getElementById('closePasswordModal');
            changePasswordBtn.onclick = () => { passwordModal.style.display = 'block'; };
            closePasswordModal.onclick = () => { passwordModal.style.display = 'none'; };
            window.onclick = function (event) {
                if (event.target === contactModal) contactModal.style.display = 'none';
                if (event.target === passwordModal) passwordModal.style.display = 'none';
            };
            // Password form submit
            document.getElementById('passwordForm').onsubmit = function (e) {
                e.preventDefault();
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                if (newPassword !== confirmPassword) {
                    document.getElementById('passwordFormMsg').textContent = 'New passwords do not match!';
                    return;
                }
                fetch('/api/faculty/profile/change-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ currentPassword, newPassword })
                })
                    .then(res => res.json())
                    .then(resp => {
                        if (resp.success) {
                            document.getElementById('passwordFormMsg').textContent = 'Password changed successfully!';
                        } else {
                            document.getElementById('passwordFormMsg').textContent = resp.message || 'Failed to change password.';
                        }
                    })
                    .catch(() => {
                        document.getElementById('passwordFormMsg').textContent = 'Failed to change password. Please try again.';
                    });
            };

            // TODO: Handle other profile features or modals
        });
    </script>
</body>

</html>